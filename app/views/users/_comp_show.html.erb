
<body style="background-color: #f6f6f6; margin-top: 40px;">
  <div id="overlay_container" class="container no_cont">
    <div class="row profile_show">

<!-- Appointments to Accept or Decline Pop Up BEGIN -->
      <div class="asspt1 text-center container" style="display: none">
        <!-- <img src="/assets/checkmark.png"> -->
        <!-- Will not go through if hour is not set -->
        <p>Accepted, wait a moment so we can get you your money</p>
      </div>
      <div class="asspt2 text-center container" style="display: none">
        <p>Declined</p>
      </div>

      <div id="appointment_pop_up_ajax_append" class="appointment_pop_up_all_container">
        <% if @appointment.length >= 1 %>
          <% @appointment.each do |appointment| %>
          <% requesting_senior = User.find_by_id(appointment.senior_id) %>
            <div id="appointment_pop_up_ajax_remove_<%= appointment.id %>" class="accept text-center appointment_pop_up_individual_container">
              <!-- Allows the Companion to Accept or Decine appointment -->
                <%= link_to "#{requesting_senior.first_name} #{requesting_senior.last_name}", user_path(requesting_senior.id) %> requests your companionship on <%= appointment.start_date.strftime('%m/%d') %>:
                <%= link_to 'Accept', accept_appointment_path(appointment_id: appointment.id), id: "accept_appointment_#{appointment.id}", class: "appointment_pop_up_button", remote: true %>
                <%= link_to 'Decline', decline_appointment_path(appointment_id: appointment.id), id: "decline_appointment_#{appointment.id}", class: "appointment_pop_up_button", remote: true %>
            </div>
          <% end %>
        <% end %>
      </div> <!-- appointment_pop_up_ajax_append END -->
<!-- Appointments to Accept or Decline Pop Up END -->

      <div class="col-lg-6" style="padding-right: 0px; padding-left: 0px;">
<!-- PROFILE -->
      <div class="profile">
        <div class="row sen_img_app">
          <div class="col-lg-6 col-md-6 sen_image">
            <div class="sen_img_upper"
              <% if !@user.avatar.url %>
                style="background-image:url(/assets/avatar_image.png);"
              <% else %>
                style="background-image: url(<%=@user.avatar.large.url if @user.avatar? %>);">
              <% end %>
              <p class="comp_rate notification"><%= final_rating(@user) %>
                <i class="fa fa-star" style="color: orange;"></i>
              </p>
              <p class="comp_fee notification">$<%= @user.fee %>/Hr
              </p>
            </div>
            <div class="edit_profile">
              <% if @user %>
                <a class="edit_tag" href="/users/<%=current_user.id %>/edit">
                        Edit Profile</a>
              <% end %>
           </div>
        </div>
        <div class="col-lg-6 col-md-6 sen_app">
            <div>
              <% if @user.first_name %>
              <h1 class="notification user"><%= @user.first_name.humanize %></h1>
              <h5 class="join_date">Joined <%= @user.created_at.strftime('%Y') %></h5>
              <% end %>
              <% if current_user.id === @user.id && current_user.assessment === "completed"  %>
                <% if !current_user.description?  || !current_user.phone_number? || !current_user.address? %>
                  <p>You must provide all <a class="edit_tag" href="/users/<%=current_user.id %>/edit">
                        Required</a> information to proceed
                    </p>
                  </p>
                <% else %>
                  <a class="edit_tag" href="/users/<%=current_user.id %>/edit">
                          Edit Profile</a>
                <% end %>
              <% end %>
            </div>

        <div class="user_contact_info">
          <% if @user.first_name %>
              <%= @user.first_name.humanize%> <%= @user.last_name.humanize%> <br>
              <%= @user.dob.strftime("%B %e, %Y") %> <br>
              <%= @user.address %> <br>
              <%= @user.city %>, <%= @user.state %> <%= @user.zipcode %> <br>
              <%= @user.email %>
          <% end %>
        </div>
        <br>
    </div>
    <span class="profile_hover">
        <i class="profile_drop">
          <p class="triangle">â–¼</p>
        </i>
    </span>
      <div class="comp_description">
        <h3 class="about_me"><Strong>About Me </Strong></h3>
        <br>
        <%= @user.description %>
      </div>
    </div>
  </div>
  <!-- TEST -->
<!-- END OF PROFILE DIV -->

        <% if @user.assessment === "no" %>
            <div class="container sen_rating text-center">
            <p> You need to <%= link_to "Take Assessment", comp_test_path  %> before you continue</p>
          </div>
        <% end %>

        <div id='stripe_section_container' class='container'>
          <%= render "transactions/show", locals: {user: @user, balance: @balance} %>
        </div>

        <div id="appointments_container">
          <h1 class="transactions-header">Upcoming Appointments:</h1>
          <div id='appointment_list_container' class='container'>
            <%= render "appointments/list_transactions" %>
          </div>
        </div>

        <div id='sen_services_tasks_container' class='container'>
          <%= render "tasks/index", locals: {user: @user} %>
        </div>

        <% if @user.reviews.count >=  0 %>
          <div class="sen_rating container">
            <h3>Reviews</h3>
            <div class="sen_stars text-center">
              <div>
                <p class="notification">Recommendation</p>
                <% wyr(@user).times do  %>
                  <i class="fa fa-star" style="color: orange;"></i>
                <% end %>
              </div>
              <div>
                <p class="notification">Companionship</p>
                <% comp_rate(@user).times do  %>
                  <i class="fa fa-star" style="color: orange;"></i>
                <% end %>
              </div>
              <div>
                <p class="notification">Communication</p>
                <% comm_rate(@user).times do  %>
                  <i class="fa fa-star" style="color: orange;"></i>
                <% end %>
              </div>
            </div>
            <p class="text-center">
              <button class="btn btn-warning" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample" style="margin-bottom: 20px; class="show_hide" value="Hide Spreads"">
                View Reviews
              </button>
            </p>
            <div class="collapse" id="collapseExample">
            <div class="row card-body">
                      <% @reviews.each do |review|%>
                        <div class="col-lg-12">
                          <div class="row form_div">
                            <div class="col-lg-2 col-md-2 col-3">
                              <img src="<%= review.reviewer.avatar.thumb.url if review.reviewer.avatar? %>" class= "img-circle responsive-image">
                            </div>
                            <div class="col col-lg-10 col-md-10 col-9 form_div">
                              <p class="notification rev_paragraphs"><%= review.comment %></p>
                              <p class="notification rev_paragraphs"><%= review.reviewer.email %></p>
                              <p class="notification rev_paragraphs"><%= individaul_rating(review) %></p>
                            </div>
                          </div>
                        </div>
                      <% end %>
                    </div>
            </div>
          </div>
        <% end %>
      </div>

<!-- CALENDAR -->
  <div class="col-lg-6 calender container">
    <div id="calendar_color_legend">
      <p class="calendar_color_item"><i class="fa fa-circle" style="color: gray;"></i> Date Unavailable </p>
      <p class="calendar_color_item"><i class="fa fa-circle" style="color: orange;"></i> Date Open for Companionship </p>
      <p class="calendar_color_item"><i class="fa fa-circle" style="color: green;"></i> Confirmed Appointment </p>
    </div>
    <div class="row" style="padding-left: 15px; padding-right: 15px;">
    <!-- This months calendar -->
      <div itemprop="provider" itemscope itemtype="http://schema.org/Organization" class="col-lg-12 text-center">
        <h1 class="servises_text_header"><span ><%= Date.today.beginning_of_month.strftime('%B')%>, <%= Date.today.beginning_of_month.strftime('%Y') %></span><h1>
      </div>
      <div id='calendar_ajax_append' class='container'>
        <%= render "available_days/calendar" %>
      </div>
    <!-- Next months calendar -->
      <div itemprop="provider" itemscope itemtype="http://schema.org/Organization" class="col-lg-12 text-center">
        <h1 class="servises_text_header"><span ><%= Date.today.beginning_of_month.next_month.strftime('%B')%>, <%= Date.today.beginning_of_month.next_month.strftime('%Y') %></span><h1>
      </div>
      <div id='calendar_ajax_append' class='container'>
        <%= render "available_days/calendar", next_month: "next" %>
      </div>
    </div>
  </div>

    <% if @comp_write_review.length > 0 %>
      <p class="text-center user_rev_par">Your reviews helps everyone</p>
      <% @comp_write_review.each  do |appointment| %>
        Review your appointment with <a href="/users/<%=appointment.senior.id  %>/reviews/new" class="edit_tag"><%= appointment.senior.first_name %></a>
      <% end %>
    <% end %>
    </div>
  </div>
</body>
